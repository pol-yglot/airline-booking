<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.travel.agency.mapper.TravelPolicyMapper">

  <!-- 정책 ResultMap -->
  <resultMap id="TravelPolicyResultMap" type="com.travel.agency.entity.TravelPolicy">
    <id column="policy_id" property="policyId"/>
    <result column="customer_id" property="customerId"/>
    <result column="allowed_flight_class" property="allowedFlightClass"/>
    <result column="allowed_hotel_grade" property="allowedHotelGrade"/>
    <result column="approval_required_yn" property="approvalRequiredYn"/>
    <result column="approval_limit_amount" property="approvalLimitAmount"/>
    <result column="created_at" property="createdAt"/>
    <result column="updated_at" property="updatedAt"/>
  </resultMap>

  <!-- 고객사 ID로 조회 -->
  <select id="selectByCustomerId" parameterType="Long" resultMap="TravelPolicyResultMap">
    SELECT * FROM travel_policy
    WHERE customer_id = #{customerId}
  </select>

  <!-- 정책 ID로 조회 -->
  <select id="selectById" parameterType="Long" resultMap="TravelPolicyResultMap">
    SELECT * FROM travel_policy
    WHERE policy_id = #{policyId}
  </select>

  <!-- 정책 등록 -->
  <insert id="insert" parameterType="com.travel.agency.entity.TravelPolicy" useGeneratedKeys="true" keyProperty="policyId">
    INSERT INTO travel_policy (customer_id, allowed_flight_class, allowed_hotel_grade, approval_required_yn, approval_limit_amount, created_at, updated_at)
    VALUES (#{customerId}, #{allowedFlightClass}, #{allowedHotelGrade}, #{approvalRequiredYn}, #{approvalLimitAmount}, NOW(), NOW())
  </insert>

  <!-- 정책 수정 -->
  <update id="update" parameterType="com.travel.agency.entity.TravelPolicy">
    UPDATE travel_policy
    SET allowed_flight_class = #{allowedFlightClass},
        allowed_hotel_grade = #{allowedHotelGrade},
        approval_required_yn = #{approvalRequiredYn},
        approval_limit_amount = #{approvalLimitAmount},
        updated_at = NOW()
    WHERE policy_id = #{policyId}
  </update>

  <!-- 정책 삭제 -->
  <delete id="delete" parameterType="Long">
    DELETE FROM travel_policy
    WHERE policy_id = #{policyId}
  </delete>

</mapper>
